generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  uid          Int        @id @default(autoincrement())
  fname        String     @db.VarChar(255)
  lname        String     @db.VarChar(255)
  email        String     @unique @db.VarChar(254)
  cardId       String?    @db.VarChar(20)
  userPassword String     @db.VarChar(255)
  attendees    Attendee[]
  events       Event[]
  history      History[]

  @@map("users")
}

model Event {
  eventid        Int      @id @default(autoincrement())
  eventowner     Int?
  eventdetail    String?
  eventimg       String?  @db.VarChar(255)
  eventstartdate DateTime @db.Date
  eventenddate   DateTime @db.Date
  eventstarttime DateTime @db.Time(6)
  eventendtime   DateTime @db.Time(6)
  regisstart     DateTime @db.Date
  regisend       DateTime @db.Date
  contact        String?
  eventtitle     String?  @db.VarChar(255)
  eventlocation  String?
  users          User?    @relation(fields: [eventowner], references: [uid], onDelete: Cascade, onUpdate: NoAction)

  @@map("events")
}

model Attendee {
  eventId Int
  uid     Int
  status  AttendeeStatus
  user    User           @relation(fields: [uid], references: [uid], onDelete: Cascade)

  @@id([eventId, uid])
  @@map("attendees")
}

model History {
  historyId  Int      @id @default(autoincrement())
  uid        Int
  eventId    Int
  scanned_at DateTime @default(now()) @db.Timestamp(6)
  user       User     @relation(fields: [uid], references: [uid], onDelete: Cascade)

  @@map("history")
}

enum AttendeeStatus {
  absent
  present
  registered
}
