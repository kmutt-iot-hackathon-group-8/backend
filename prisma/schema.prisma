// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  uid           Int      @id @default(autoincrement())
  fname         String   @db.VarChar(255)
  lname         String   @db.VarChar(255)
  email         String   @unique @db.VarChar(254)
  cardId        String?  @db.VarChar(20)
  userPassword  String   @db.VarChar(255)
  events        Event[]
  attendees     Attendee[]
  history       History[]

  @@map("users")
}

model Event {
  eventId         Int         @id @default(autoincrement())
  eventOwner      Int
  eventDetail     String?     @db.Text
  eventIMG        String?     @db.VarChar(255)
  eventStartDate  DateTime   @db.Date
  eventEndDate    DateTime   @db.Date
  eventStartTime  DateTime   @db.Time
  eventEndTime    DateTime   @db.Time
  regisStart      DateTime   @db.Date
  regisEnd        DateTime   @db.Date
  contact         String?     @db.Text
  regisURL        String      @db.Text
  owner           User        @relation(fields: [eventOwner], references: [uid], onDelete: Cascade)
  attendees       Attendee[]
  history         History[]

  @@map("events")
}

model Attendee {
  eventId   Int
  uid       Int
  status    AttendeeStatus
  event     Event @relation(fields: [eventId], references: [eventId], onDelete: Cascade)
  user      User  @relation(fields: [uid], references: [uid], onDelete: Cascade)

  @@id([eventId, uid])
  @@map("attendees")
}

model History {
  historyId  Int      @id @default(autoincrement())
  uid        Int
  eventId    Int
  scanned_at DateTime @default(now()) @db.Timestamp
  user       User     @relation(fields: [uid], references: [uid], onDelete: Cascade)
  event      Event    @relation(fields: [eventId], references: [eventId], onDelete: Cascade)

  @@map("history")
}

enum AttendeeStatus {
  absent
  present
  registered
}